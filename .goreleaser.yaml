version: 2
project_name: kumabot

before:
  hooks:
    - go mod tidy

archives:
  - formats: ["tar.gz"]
    name_template: "{{ .ProjectName }}_{{ title .Os }}_{{ .Arch }}"

release:
  mode: replace
  draft: false

docker_builders:
  - id: kumabot-docker
    dockerfile: Dockerfile
    images:
      - "ghcr.io/{{ .Runtime.GitHubOrg }}/{{ .ProjectName }}:{{ .Tag }}"
      - "ghcr.io/{{ .Runtime.GitHubOrg }}/{{ .ProjectName }}:latest"
      - "docker.io/{{ .Env.DOCKER_USERNAME }}/{{ .ProjectName }}:{{ .Tag }}"
      - "docker.io/{{ .Env.DOCKER_USERNAME }}/{{ .ProjectName }}:latest"
    
    flags:
      - "--label=org.opencontainers.image.title={{ .ProjectName }}"
      - "--label=org.opencontainers.image.version={{ .Version }}"
      - "--label=org.opencontainers.image.revision={{ .FullCommit }}"
    
    platforms:
      - linux/amd64
      - linux/arm64

    skip_push: "{{ .Prerelease }}"
